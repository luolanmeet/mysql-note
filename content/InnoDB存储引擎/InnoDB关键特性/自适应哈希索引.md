### 自适应哈希索引

#### 定义

哈希是一种非常快的查找方法，一般情况下时间复杂度为O(1)，即需要一次查找就能

定位数据，而B+树的查找次数取决于B+树的高度，在生产环境中，B+树的高度一般

为3~4层，故需要3~4次的查询。

`InnoDB`存储引擎会监控对表上各索引页的查询。如果观察到哈希索引可以带来速度提升，

则建立哈希索引，称之为自适应哈希索引（`Adaptive Hash Index`，`AHI`）。



#### AHI

`AHI`是通过缓冲池的B+树页构造而来，因此建立的速度很快，不需要对整张表构建

哈希索引。`InnoDB`存储引擎会自动根据访问的频率和模式来自动地为某些热点页建立

哈希索引。



#### AHI的要求

为页建立`AHI`要求，对这个页的连续访问模式必须是一样的。访问模式一样指的是

查询的条件一样。

> 交替使用 `where a = xxx` 和  `where a = xxx and b = xxx`，
>
> 将不会为该页建立`AHI`

需要以该模式访问了100次，页通过该模式访问了N次，其中N=页中记录 / 16



#### AHI的效果

根据`InnoDB`存储引擎官方的文档显示，启用`AHI`后，读取和写入速度可以提高2倍，

辅助索引的连续操作性能可以提高5倍。

`AHI`是很好的优化模式，其设计思想是数据库自优化（`self-tuning`），即无需`DBA`

对数据库进行人为调整。