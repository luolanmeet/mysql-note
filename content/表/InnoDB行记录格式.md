### InnoDB行记录格式

`InnoDB`存储引擎和大多数数据库一样，记录是以行的形式存储的。

这意味着页总保存着表中一行行的数据。

`InnoDB`存储引擎提供了`Compact`和`Redundant`两种格式来存放行记录数据。

`Redundant`格式是为兼容之前版本而保留的，`Compact`是`MySQL 5.1`版本默认的行格式。

可以通过命令 `SHOW TABLE STATUS LIKE "table_name"` 来查看那当前表使用的行格式。



#### Compact行记录格式

`Compact`行记录是在`MySQL 5.0`中引入的，其设计目标是高效地存储数据。简单来说，

一个页中存放的行数据越多，其性能就越高。

|                  |            |            |         |         |      |
| ---------------- | ---------- | ---------- | ------- | ------- | ---- |
| 变长字段长度列表 | NULL标志位 | 记录头信息 | 列1数据 | 类2数据 | ...  |

`Compact`行记录格式的首部是一个非NULL变长字段长度列表，并且其是按照列的顺序逆序放置的，

长度为：

* 若列的长度小于255字节，用1字节表示
* 若大于255个字节，用2字节表示（所以`VARCHAR`类型最大长度是65535）

第二部分是`NULL`标识位，指示了该行数据中是否有`NULL`值，有则用1表示。

第三部分是记录头信息（`record header`），固定占用5字节。含义如下：

| 名称         | 大小（bit） | 描述                                                         |
| ------------ | ----------- | ------------------------------------------------------------ |
| ()           | 1           | 未知                                                         |
| ()           | 1           | 未知                                                         |
| deleted_flag | 1           | 该行是否已被删除                                             |
| min_rec_flag | 1           | 为1，如果该记录是预先被定义为最小的记录<br />啥子？          |
| n_owned      | 4           | 该记录拥有的记录数                                           |
| heap_no      | 13          | 索引堆中该记录的排序记录                                     |
| record_type  | 3           | 记录类型，000表示普通，001表示B+树节点指针，010表示Infimun<br />011表示Supremum，1xx表示保留 |
| next_record  | 16          | 页中下一条记录的相对位置                                     |
| total        | 40          |                                                              |

最后部分就是实际存储每个列的数据。需要特别注意的是，`NULL`不占该部分任何空间。

> 此外，每行数据除了用户定义的列外，还有两个隐藏列，事务ID列和回滚指针列，
>
> 分别为6字节和7字节的大小。若`InnoDB`表没有定义主键，每行还会增加一个6字节的rowid列。